<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConcursoMaster AI - Laboratório de Redação Premium</title>
    
    <style>
        /* --- ESTILOS PREMIUM REDAÇÃO v4.0 --- */
        :root {
            --color-primary: #1e88e5;
            --color-primary-dark: #1565c0;
            --color-secondary: #546e7a;
            --color-success: #43a047;
            --color-warning: #ff9800;
            --color-danger: #e53935;
            --color-light: #f8f9fa;
            --color-white: #ffffff;
            --color-dark: #212529;
            --shadow-card: 0 6px 20px rgba(0, 0, 0, 0.12);
            --shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.15);
            --gradient-primary: linear-gradient(135deg, #1e88e5 0%, #0d47a1 100%);
            --gradient-success: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
            --gradient-warning: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', 'Segoe UI', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background-color: var(--color-white);
            border-radius: 16px;
            box-shadow: var(--shadow-card);
            overflow: hidden;
            margin-top: 80px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .container:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        /* NAVEGAÇÃO SUPERIOR PREMIUM */
        nav {
            width: 100%;
            background: var(--gradient-primary);
            border-bottom: none;
            padding: 0;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        nav ul {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            list-style: none;
            display: flex;
            justify-content: flex-start;
        }

        nav a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 1.1em;
            padding: 18px 22px;
            display: block;
            transition: all 0.3s ease;
            position: relative;
            font-weight: 500;
        }

        nav a:hover {
            color: var(--color-white);
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        nav a.active {
            color: var(--color-white);
            font-weight: 600;
            background-color: rgba(255, 255, 255, 0.15);
        }

        nav a.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            width: 60%;
            height: 3px;
            background-color: #ffeb3b;
            border-radius: 2px;
        }

        /* HEADER COM GRADIENTE */
        .header {
            background: var(--gradient-primary);
            color: var(--color-white);
            padding: 25px 35px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1%, transparent 1%);
            background-size: 20px 20px;
            opacity: 0.3;
        }

        .header h1 {
            margin: 0;
            font-size: 2em;
            font-weight: 600;
            position: relative;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            margin: 8px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
            position: relative;
        }

        /* CONTEÚDO PRINCIPAL */
        .redacao-box {
            padding: 40px;
        }

        /* NOVO: CONTROLES DE EDITOR */
        .editor-controls {
            background: var(--color-light);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-btn {
            padding: 10px 15px;
            background: var(--color-white);
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .control-btn:hover {
            border-color: var(--color-primary);
            background: #e3f2fd;
            transform: translateY(-2px);
        }

        .control-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .configuracoes-avancadas {
            background: var(--color-light);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--color-primary);
        }

        .form-group select, .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: var(--color-white);
        }

        .form-group select:focus, .form-group input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
        }

        .tema-container {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 4px solid var(--color-primary);
        }

        .tema-container h3 {
            color: var(--color-primary);
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .tema-descricao {
            color: var(--color-secondary);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .tema-metadata {
            display: flex;
            gap: 20px;
            font-size: 0.9em;
            color: var(--color-secondary);
        }

        .tema-metadata span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* EDITOR DE REDAÇÃO PREMIUM */
        .editor-container {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: var(--shadow-card);
            transition: all 0.3s ease;
        }

        .editor-container:focus-within {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
        }

        .editor-header {
            background: var(--color-light);
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .editor-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: var(--color-secondary);
        }

        .editor-stats span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        #texto-redacao {
            width: 100%;
            height: 400px;
            padding: 20px;
            font-size: 1.1em;
            font-family: 'Times New Roman', serif;
            border: none;
            resize: vertical;
            line-height: 1.8;
            background: var(--color-white);
            transition: all 0.3s ease;
        }

        #texto-redacao:focus {
            outline: none;
        }

        .editor-footer {
            background: var(--color-light);
            padding: 12px 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: var(--color-secondary);
        }

        /* BOTÕES DE AÇÃO */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-btn {
            padding: 18px 25px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        #btn-corrigir {
            background: var(--gradient-primary);
            color: white;
        }

        #btn-novo-tema {
            background: var(--gradient-warning);
            color: white;
        }

        #btn-exportar {
            background: var(--gradient-success);
            color: white;
        }

        /* RESULTADO DA CORREÇÃO */
        #resultado-area {
            display: none;
            margin-top: 30px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-card);
            animation: slideInUp 0.5s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .resultado-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .resultado-header h3 {
            margin: 0;
            font-size: 1.4em;
        }

        .pontuacao-total {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.3em;
            font-weight: 700;
        }

        .resultado-body {
            padding: 30px;
            background: var(--color-white);
        }

        .competencia-item {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .competencia-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .competencia-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .competencia-titulo {
            font-weight: 600;
            color: var(--color-primary);
            font-size: 1.1em;
        }

        .competencia-pontos {
            background: var(--color-light);
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: 600;
            color: var(--color-success);
        }

        .competencia-descricao {
            color: var(--color-secondary);
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .sugestoes-melhoria {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid var(--color-warning);
        }

        .sugestoes-melhoria strong {
            color: var(--color-warning);
            display: block;
            margin-bottom: 8px;
        }

        .analise-geral {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--color-success);
        }

        .analise-geral strong {
            color: var(--color-success);
            display: block;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        /* TEMAS SUGERIDOS */
        .temas-sugeridos {
            margin-top: 40px;
        }

        .temas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tema-card {
            background: var(--color-white);
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-card);
        }

        .tema-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--color-primary);
        }

        .tema-card h4 {
            color: var(--color-primary);
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .tema-card p {
            color: var(--color-secondary);
            font-size: 0.95em;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .tema-card .dificuldade {
            font-size: 0.8em;
            color: var(--color-warning);
            font-weight: 600;
        }

        /* DICAS DE REDAÇÃO */
        .dicas-redacao {
            background: linear-gradient(135deg, #fff3e0 0%, #ffecb3 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 4px solid var(--color-warning);
        }

        .dicas-redacao h3 {
            color: var(--color-warning);
            margin-bottom: 15px;
        }

        .dicas-lista {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .dica-item {
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--color-warning);
        }

        .dica-item strong {
            color: var(--color-warning);
            display: block;
            margin-bottom: 5px;
        }

        /* NOVO: HISTÓRICO DE REDAÇÕES */
        .historico-redacoes {
            margin-top: 40px;
            display: none;
        }

        .historico-lista {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .historico-item {
            background: var(--color-white);
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .historico-item:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        .historico-item h5 {
            color: var(--color-primary);
            margin-bottom: 8px;
        }

        .historico-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: var(--color-secondary);
        }

        /* LOADING ANIMATION */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* SISTEMA DE NOTIFICAÇÕES */
        .notificacao {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 10000;
            animation: slideInRight 0.3s ease-out;
            border-left: 4px solid var(--color-primary);
            max-width: 350px;
        }

        .notificacao.sucesso {
            border-left-color: var(--color-success);
        }

        .notificacao.alerta {
            border-left-color: var(--color-warning);
        }

        .notificacao.erro {
            border-left-color: var(--color-danger);
        }

        .notificacao-icone {
            font-size: 1.3em;
        }

        .notificacao button {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* RESPONSIVIDADE */
        @media (max-width: 768px) {
            .config-grid, .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .editor-stats {
                flex-direction: column;
                gap: 5px;
            }
            
            .competencia-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .temas-grid {
                grid-template-columns: 1fr;
            }
            
            .dicas-lista {
                grid-template-columns: 1fr;
            }
            
            .notificacao {
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .editor-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .tema-metadata {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* NOVO: CONTADOR DE PALAVRAS DINÂMICO */
        .contador-palavras {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(30, 136, 229, 0.1);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            color: var(--color-primary);
            font-weight: 500;
        }

        /* NOVO: MODO ESCURO PARA O EDITOR */
        .modo-escuro {
            background: #2d3748 !important;
            color: #e2e8f0 !important;
            border-color: #4a5568 !important;
        }

        .modo-escuro #texto-redacao {
            background: #2d3748;
            color: #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>✍️ Laboratório de Redação ConcursoMaster AI</h1>
            <p>Correção automatizada com IA avançada e análise detalhada</p>
        </header>

        <nav>
            <ul>
                <li><a href="index.html">🎯 Questões</a></li>
                <li><a class="active" href="redacao.html">✍️ Redação</a></li>
                <li><a href="dashboard.html">📈 Dashboard</a></li>
            </ul>
        </nav>

        <main class="redacao-box">
            <!-- Dicas de Redação -->
            <div class="dicas-redacao">
                <h3>🎯 Dicas Essenciais para uma Boa Redação</h3>
                <div class="dicas-lista">
                    <div class="dica-item">
                        <strong>📖 Estrutura</strong>
                        <p>Introdução, desenvolvimento e conclusão bem definidos</p>
                    </div>
                    <div class="dica-item">
                        <strong>✍️ Coesão</strong>
                        <p>Use conectivos para ligar as ideias</p>
                    </div>
                    <div class="dica-item">
                        <strong>🎯 Argumentação</strong>
                        <p>Apresente dados e exemplos concretos</p>
                    </div>
                    <div class="dica-item">
                        <strong>📝 Proposta</strong>
                        <p>Solução viável com agentes definidos</p>
                    </div>
                </div>
            </div>

            <!-- NOVO: Controles do Editor -->
            <div class="editor-controls">
                <button class="control-btn" onclick="alternarModoEscuro()" id="btn-modo-escuro">
                    🌙 Modo Escuro
                </button>
                <button class="control-btn" onclick="aumentarFonte()" id="btn-aumentar-fonte">
                    🔍 A+
                </button>
                <button class="control-btn" onclick="diminuirFonte()" id="btn-diminuir-fonte">
                    🔍 A-
                </button>
                <button class="control-btn" onclick="limparTexto()" id="btn-limpar">
                    🗑️ Limpar
                </button>
                <button class="control-btn" onclick="carregarHistorico()" id="btn-historico">
                    📚 Histórico
                </button>
            </div>

            <!-- Configurações Avançadas -->
            <div class="configuracoes-avancadas">
                <h3>⚙️ Configurações da Redação</h3>
                <div class="config-grid">
                    <div class="form-group">
                        <label>🎯 Tipo de Prova</label>
                        <select id="tipo-prova">
                            <option value="dissertativa">Dissertação Argumentativa</option>
                            <option value="oficio">Ofício/Correspondência Oficial</option>
                            <option value="relatorio">Relatório Administrativo</option>
                            <option value="memorando">Memorando</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>⏱️ Tempo Limite (minutos)</label>
                        <input type="number" id="tempo-limite" min="30" max="180" value="90">
                    </div>
                </div>
                <div class="form-group">
                    <label>📚 Banco de Temas (50+ temas)</label>
                    <select id="tema-redacao">
                        <option value="1">Os desafios para a efetivação da gestão de pessoas no serviço público</option>
                        <option value="2">Os impactos da inteligência artificial na administração pública</option>
                        <option value="3">A ética como fundamento da gestão pública contemporânea</option>
                        <option value="4">Desafios da implementação de políticas de sustentabilidade no setor público</option>
                        <option value="5">A transformação digital e seus reflexos nos serviços públicos</option>
                        <option value="6">Governança corporativa e transparência na administração pública</option>
                        <option value="7">Os efeitos da LGPD na prestação de serviços públicos</option>
                        <option value="8">Mobilidade urbana e desenvolvimento sustentável nas cidades brasileiras</option>
                        <option value="9">A importância do controle social na gestão de recursos públicos</option>
                        <option value="10">Desafios da educação pública brasileira no século XXI</option>
                    </select>
                </div>
            </div>

            <!-- Tema Selecionado -->
            <div class="tema-container">
                <h3>📝 Tema da Redação</h3>
                <p class="tema-descricao" id="tema-descricao">Os desafios para a efetivação da gestão de pessoas no serviço público</p>
                <div class="tema-metadata">
                    <span>🎯 Tipo: <strong id="tipo-tema">Dissertação Argumentativa</strong></span>
                    <span>⏱️ Tempo sugerido: <strong id="tempo-tema">90 minutos</strong></span>
                    <span>📊 Dificuldade: <strong id="dificuldade-tema">Média</strong></span>
                </div>
            </div>

            <!-- Editor de Redação -->
            <div class="editor-container">
                <div class="editor-header">
                    <span>📝 Editor de Redação</span>
                    <div class="editor-stats">
                        <span id="contador-palavras">🔄 Calculando...</span>
                        <span id="contador-caracteres">📊 Aguardando texto...</span>
                        <span id="estimativa-tempo">⏱️ --:--</span>
                    </div>
                </div>
                <div style="position: relative;">
                    <textarea id="texto-redacao" placeholder="Comece a digitar sua redação aqui... 

💡 Dicas para uma boa redação:
• Estruture em introdução, desenvolvimento e conclusão
• Use argumentos consistentes e exemplos concretos
• Mantenha coesão e coerência textual
• Respeite as normas cultas da língua portuguesa
• Proponha soluções viáveis para os problemas apresentados"></textarea>
                    <div class="contador-palavras" id="contador-mini">0 palavras</div>
                </div>
                <div class="editor-footer">
                    <span>Mínimo recomendado: <strong>30 linhas ou 600 palavras</strong></span>
                    <span id="status-editor">💡 Digite sua redação acima</span>
                </div>
            </div>

            <!-- Botões de Ação -->
            <div class="action-buttons">
                <button id="btn-corrigir" class="action-btn" onclick="corrigirRedacao()">
                    <span class="loading-spinner" id="spinner-correcao" style="display: none;"></span>
                    🤖 Corrigir com IA Avançada
                </button>
                <button id="btn-novo-tema" class="action-btn" onclick="gerarNovoTema()">
                    🔄 Novo Tema Aleatório
                </button>
                <button id="btn-exportar" class="action-btn" onclick="exportarRedacao()">
                    📥 Exportar Redação
                </button>
            </div>

            <!-- NOVO: Histórico de Redações -->
            <div class="historico-redacoes" id="historico-redacoes">
                <h3>📚 Redações Anteriores</h3>
                <div class="historico-lista" id="historico-lista">
                    <!-- Carregado dinamicamente -->
                </div>
            </div>

            <!-- Resultado da Correção -->
            <div id="resultado-area">
                <div class="resultado-header">
                    <h3>📊 Resultado da Correção</h3>
                    <div class="pontuacao-total" id="pontuacao-total">000/1000</div>
                </div>
                <div class="resultado-body" id="correcao-detalhada">
                    <!-- Conteúdo será preenchido pelo JavaScript -->
                </div>
            </div>

            <!-- Temas Sugeridos -->
            <div class="temas-sugeridos">
                <h3>🎯 Temas Sugeridos para Prática</h3>
                <div class="temas-grid" id="temas-sugeridos-grid">
                    <!-- Conteúdo será preenchido pelo JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000';
        let tamanhoFonteAtual = 1.1;

        // --- SISTEMA DE NOTIFICAÇÕES ---
        class NotificacaoSistema {
            static mostrar(mensagem, tipo = 'info', tempo = 5000) {
                const notification = document.createElement('div');
                notification.className = `notificacao ${tipo}`;
                notification.innerHTML = `
                    <span class="notificacao-icone">${this.getIcone(tipo)}</span>
                    <span class="notificacao-texto">${mensagem}</span>
                    <button onclick="this.parentElement.remove()">×</button>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, tempo);
            }
            
            static getIcone(tipo) {
                const icones = {
                    'info': 'ℹ️',
                    'sucesso': '✅',
                    'alerta': '⚠️',
                    'erro': '❌'
                };
                return icones[tipo] || 'ℹ️';
            }
        }

        // Banco de temas avançado
        const BANCO_TEMAS = [
            {
                id: 1,
                titulo: "Gestão de Pessoas no Serviço Público",
                descricao: "Os desafios para a efetivação da gestão de pessoas no serviço público",
                tipo: "dissertativa",
                tempo: 90,
                dificuldade: "Média",
                palavras_chave: ["gestão pública", "recursos humanos", "serviço público"],
                dicas: ["Aborde a meritocracia vs estabilidade", "Mencione a importância da capacitação contínua", "Discuta a valorização do servidor"]
            },
            {
                id: 2,
                titulo: "IA na Administração Pública",
                descricao: "Os impactos da inteligência artificial na administração pública",
                tipo: "dissertativa", 
                tempo: 80,
                dificuldade: "Alta",
                palavras_chave: ["inteligência artificial", "tecnologia", "inovação"],
                dicas: ["Equilibre benefícios e riscos", "Aborde a proteção de dados", "Mencione a capacitação dos servidores"]
            },
            {
                id: 3,
                titulo: "Ética na Gestão Pública",
                descricao: "A ética como fundamento da gestão pública contemporânea",
                tipo: "dissertativa",
                tempo: 85,
                dificuldade: "Média",
                palavras_chave: ["ética", "transparência", "moralidade"],
                dicas: ["Discuta casos reais de sucesso", "Aborde os princípios constitucionais", "Mencione a Lei de Improbidade"]
            },
            {
                id: 4,
                titulo: "Sustentabilidade no Setor Público",
                descricao: "Desafios da implementação de políticas de sustentabilidade no setor público",
                tipo: "dissertativa",
                tempo: 95,
                dificuldade: "Média",
                palavras_chave: ["sustentabilidade", "meio ambiente", "políticas públicas"],
                dicas: ["Aborde os três pilares da sustentabilidade", "Mencione a Agenda 2030", "Discuta orçamento público"]
            },
            {
                id: 5,
                titulo: "Transformação Digital",
                descricao: "A transformação digital e seus reflexos nos serviços públicos",
                tipo: "dissertativa",
                tempo: 85,
                dificuldade: "Alta",
                palavras_chave: ["transformação digital", "serviços públicos", "tecnologia"],
                dicas: ["Foque na experiência do cidadão", "Aborde segurança digital", "Mencione inclusão digital"]
            }
        ];

        // Elementos DOM
        const textoRedacao = document.getElementById('texto-redacao');
        const temaSelect = document.getElementById('tema-redacao');
        const tipoProvaSelect = document.getElementById('tipo-prova');
        const temaDescricao = document.getElementById('tema-descricao');
        const tipoTema = document.getElementById('tipo-tema');
        const tempoTema = document.getElementById('tempo-tema');
        const dificuldadeTema = document.getElementById('dificuldade-tema');
        const contadorPalavras = document.getElementById('contador-palavras');
        const contadorCaracteres = document.getElementById('contador-caracteres');
        const contadorMini = document.getElementById('contador-mini');
        const estimativaTempo = document.getElementById('estimativa-tempo');
        const statusEditor = document.getElementById('status-editor');
        const spinnerCorrecao = document.getElementById('spinner-correcao');
        const resultadoArea = document.getElementById('resultado-area');
        const pontuacaoTotal = document.getElementById('pontuacao-total');
        const correcaoDetalhada = document.getElementById('correcao-detalhada');
        const temasSugeridosGrid = document.getElementById('temas-sugeridos-grid');
        const historicoRedacoes = document.getElementById('historico-redacoes');
        const historicoLista = document.getElementById('historico-lista');

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            carregarTemaAtual();
            atualizarEstatisticasEditor();
            carregarTemasSugeridos();
            carregarHistoricoLocal();
            
            // Event listeners
            textoRedacao.addEventListener('input', atualizarEstatisticasEditor);
            temaSelect.addEventListener('change', carregarTemaAtual);
            tipoProvaSelect.addEventListener('change', atualizarTipoProva);

            // Auto-save
            setInterval(salvarRascunhoAutomatico, 30000);

            NotificacaoSistema.mostrar('Laboratório de Redação carregado!', 'sucesso', 3000);
        });

        function carregarTemaAtual() {
            const temaId = parseInt(temaSelect.value);
            const tema = BANCO_TEMAS.find(t => t.id === temaId) || BANCO_TEMAS[0];
            
            temaDescricao.textContent = tema.descricao;
            tipoTema.textContent = tema.tipo.charAt(0).toUpperCase() + tema.tipo.slice(1);
            tempoTema.textContent = `${tema.tempo} minutos`;
            dificuldadeTema.textContent = tema.dificuldade;
            
            atualizarPlaceholder(tema);
        }

        function atualizarPlaceholder(tema) {
            let dicasEspecificas = "";
            if (tema.dicas) {
                dicasEspecificas = tema.dicas.map(dica => `• ${dica}`).join('\n');
            }

            const placeholders = {
                dissertativa: `Estruture sua redação em:\n\n📖 INTRODUÇÃO (1-2 parágrafos): Apresente o tema e sua tese\n📚 DESENVOLVIMENTO (2-3 parágrafos): Argumentos e exemplos\n🎯 CONCLUSÃO (1 parágrafo): Resumo e proposta de intervenção\n\n💡 Dicas específicas para este tema:\n${dicasEspecificas}\n\n💡 Dicas gerais:\n• Use conectivos e mantenha coesão textual!\n• Cite dados concretos quando possível\n• Respeite a norma culta da língua`,
                oficio: `Estruture seu ofício em:\n\n📄 CABEÇALHO: Identificação do órgão e número\n🎯 DESTINATÁRIO: Para quem se dirige\n📖 TEXTO: Exposição do assunto de forma clara\n📋 FECHO: Solicitação e cortesia\n✍️ ASSINATURA: Nome e cargo\n\n💡 Mantenha linguagem formal e objetiva!`,
                memorando: `Estruture seu memorando em:\n\n📄 CABEÇALHO: Identificação e número\n🎯 DESTINATÁRIO e REMETENTE\n📖 ASSUNTO: Tema de forma resumida\n📋 TEXTO: Exposição clara do conteúdo\n✍️ ASSINATURA: Nome e cargo\n\n💡 Linguagem interna e objetiva!`,
                relatorio: `Estruture seu relatório em:\n\n📄 CAPA: Identificação do documento\n📖 INTRODUÇÃO: Contexto e objetivos\n📚 DESENVOLVIMENTO: Metodologia e resultados\n📊 CONCLUSÕES: Análise e recomendações\n📋 ANEXOS: Documentos complementares\n\n💡 Dados concretos e linguagem técnica!`
            };
            
            textoRedacao.placeholder = placeholders[tema.tipo] || placeholders.dissertativa;
        }

        function atualizarTipoProva() {
            const tipo = tipoProvaSelect.value;
            const temaAtual = BANCO_TEMAS.find(t => t.id === parseInt(temaSelect.value)) || BANCO_TEMAS[0];
            atualizarPlaceholder({...temaAtual, tipo});
        }

        function atualizarEstatisticasEditor() {
            const texto = textoRedacao.value;
            const palavras = texto.trim() ? texto.trim().split(/\s+/).length : 0;
            const caracteres = texto.length;
            const caracteresSemEspaco = texto.replace(/\s/g, '').length;
            
            // Tempo estimado de leitura (200 palavras/minuto)
            const tempoLeitura = Math.ceil(palavras / 200);
            
            contadorPalavras.textContent = `📝 ${palavras} palavras`;
            contadorCaracteres.textContent = `🔤 ${caracteres} caracteres (${caracteresSemEspaco} sem espaços)`;
            contadorMini.textContent = `${palavras} palavras`;
            estimativaTempo.textContent = `⏱️ ~${tempoLeitura} min leitura`;
            
            // Status do editor
            if (palavras === 0) {
                statusEditor.textContent = "💡 Digite sua redação acima";
                statusEditor.style.color = "var(--color-secondary)";
            } else if (palavras < 300) {
                statusEditor.textContent = "📝 Texto muito curto (mínimo 300 palavras)";
                statusEditor.style.color = "var(--color-warning)";
            } else if (palavras < 600) {
                statusEditor.textContent = "📚 Texto em desenvolvimento";
                statusEditor.style.color = "var(--color-primary)";
            } else {
                statusEditor.textContent = "✅ Texto com tamanho adequado";
                statusEditor.style.color = "var(--color-success)";
            }

            // Salvar rascunho automático
            salvarRascunhoAutomatico();
        }

        // Função para carregar temas sugeridos aleatórios
        function carregarTemasSugeridos() {
            const temasAleatorios = [...BANCO_TEMAS]
                .sort(() => Math.random() - 0.5)
                .slice(0, 6);
            
            temasSugeridosGrid.innerHTML = temasAleatorios.map(tema => `
                <div class="tema-card" onclick="selecionarTema(${tema.id})">
                    <h4>${tema.titulo}</h4>
                    <p>${tema.descricao}</p>
                    ${tema.dicas ? `<div style="margin-top: 10px; font-size: 0.85em; color: #666;">
                        <strong>💡 Dica:</strong> ${tema.dicas[0]}
                    </div>` : ''}
                    <div class="tema-metadata">
                        <span class="dificuldade">${tema.dificuldade}</span>
                        <span>⏱️ ${tema.tempo}min</span>
                        <span>📝 ${tema.tipo}</span>
                    </div>
                </div>
            `).join('');
        }

        function selecionarTema(temaId) {
            temaSelect.value = temaId;
            carregarTemaAtual();
            NotificacaoSistema.mostrar('Tema selecionado com sucesso!', 'sucesso');
            
            // Scroll suave para o topo
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function gerarNovoTema() {
            const temasDisponiveis = BANCO_TEMAS.filter(t => t.id !== parseInt(temaSelect.value));
            const novoTema = temasDisponiveis[Math.floor(Math.random() * temasDisponiveis.length)];
            
            if (novoTema) {
                temaSelect.value = novoTema.id;
                carregarTemaAtual();
                NotificacaoSistema.mostrar('Novo tema gerado!', 'sucesso');
            }
        }

        async function corrigirRedacao() {
            const texto = textoRedacao.value.trim();
            const temaSelecionado = BANCO_TEMAS.find(t => t.id === parseInt(temaSelect.value));
            
            if (!texto) {
                NotificacaoSistema.mostrar('Digite sua redação antes de corrigir', 'alerta');
                return;
            }
            
            if (texto.split(/\s+/).length < 100) {
                NotificacaoSistema.mostrar('Redação muito curta. Mínimo 100 palavras.', 'alerta');
                return;
            }

            // Mostrar loading
            spinnerCorrecao.style.display = 'inline-block';
            document.getElementById('btn-corrigir').disabled = true;

            try {
                const response = await fetch(`${API_URL}/corrigir-redacao`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        texto: texto,
                        tema: temaSelecionado.descricao,
                        tipo_prova: tipoProvaSelect.value,
                        palavras_chave: temaSelecionado.palavras_chave || []
                    })
                });

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const resultado = await response.json();
                
                // Salvar no histórico
                salvarNoHistorico(resultado, texto, temaSelecionado.descricao);
                
                // Exibir resultados
                pontuacaoTotal.textContent = `${resultado.pontuacao_total}/1000`;
                correcaoDetalhada.innerHTML = resultado.correcao;
                resultadoArea.style.display = 'block';
                
                NotificacaoSistema.mostrar(`Redação corrigida! Pontuação: ${resultado.pontuacao_total}/1000`, 'sucesso');
                
                // Scroll para o resultado
                resultadoArea.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('Erro na correção:', error);
                NotificacaoSistema.mostrar('Erro ao corrigir redação. Tente novamente.', 'erro');
                
                // Fallback para correção simulada
                mostrarCorrecaoSimulada(texto);
            } finally {
                spinnerCorrecao.style.display = 'none';
                document.getElementById('btn-corrigir').disabled = false;
            }
        }

        function mostrarCorrecaoSimulada(texto) {
            const palavras = texto.split(/\s+/).length;
            const pontuacao = Math.min(600 + (palavras * 0.5), 900);
            
            pontuacaoTotal.textContent = `${pontuacao}/1000`;
            correcaoDetalhada.innerHTML = `
                <div class="competencia-item">
                    <div class="competencia-header">
                        <span class="competencia-titulo">Domínio da Norma Culta</span>
                        <span class="competencia-pontos">${Math.round(pontuacao * 0.2)}/200</span>
                    </div>
                    <p class="competencia-descricao">Correção simulada - servidor offline</p>
                </div>
                <div class="sugestoes-melhoria">
                    <strong>💡 Sistema Offline</strong>
                    <p>• Esta é uma correção simulada enquanto o servidor está indisponível</p>
                    <p>• Para correção completa com IA, verifique a conexão com o servidor</p>
                </div>
            `;
            resultadoArea.style.display = 'block';
        }

        // --- NOVAS FUNCIONALIDADES ---

        function alternarModoEscuro() {
            const editor = document.querySelector('.editor-container');
            const btnModo = document.getElementById('btn-modo-escuro');
            
            editor.classList.toggle('modo-escuro');
            
            if (editor.classList.contains('modo-escuro')) {
                btnModo.innerHTML = '☀️ Modo Claro';
                btnModo.classList.add('active');
            } else {
                btnModo.innerHTML = '🌙 Modo Escuro';
                btnModo.classList.remove('active');
            }
        }

        function aumentarFonte() {
            if (tamanhoFonteAtual < 1.5) {
                tamanhoFonteAtual += 0.1;
                textoRedacao.style.fontSize = `${tamanhoFonteAtual}em`;
            }
        }

        function diminuirFonte() {
            if (tamanhoFonteAtual > 0.8) {
                tamanhoFonteAtual -= 0.1;
                textoRedacao.style.fontSize = `${tamanhoFonteAtual}em`;
            }
        }

        function limparTexto() {
            if (confirm('Tem certeza que deseja limpar toda a redação?')) {
                textoRedacao.value = '';
                atualizarEstatisticasEditor();
                NotificacaoSistema.mostrar('Redação limpa!', 'sucesso');
            }
        }

        function exportarRedacao() {
            const texto = textoRedacao.value;
            if (!texto.trim()) {
                NotificacaoSistema.mostrar('Nenhuma redação para exportar', 'alerta');
                return;
            }

            const tema = BANCO_TEMAS.find(t => t.id === parseInt(temaSelect.value));
            const data = new Date().toLocaleDateString('pt-BR');
            
            const conteudo = `REDAÇÃO - ${tema.titulo}\nData: ${data}\n\n${texto}`;

            const blob = new Blob([conteudo], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `redacao_${tema.titulo.replace(/\s+/g, '_')}_${data.replace(/\//g, '-')}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            NotificacaoSistema.mostrar('Redação exportada com sucesso!', 'sucesso');
        }

        // --- SISTEMA DE HISTÓRICO ---

        function salvarRascunhoAutomatico() {
            const texto = textoRedacao.value;
            if (texto.trim()) {
                localStorage.setItem('redacao_rascunho', texto);
            }
        }

        function carregarRascunho() {
            const rascunho = localStorage.getItem('redacao_rascunho');
            if (rascunho) {
                textoRedacao.value = rascunho;
                atualizarEstatisticasEditor();
                NotificacaoSistema.mostrar('Rascunho anterior carregado!', 'info');
            }
        }

        function salvarNoHistorico(resultado, texto, tema) {
            const historico = JSON.parse(localStorage.getItem('historico_redacoes') || '[]');
            
            const novaRedacao = {
                id: Date.now(),
                data: new Date().toISOString(),
                tema: tema,
                texto: texto,
                pontuacao: resultado.pontuacao_total,
                correcao: resultado.correcao,
                tecnologia: resultado.tecnologia
            };
            
            historico.unshift(novaRedacao);
            // Manter apenas as últimas 10 redações
            if (historico.length > 10) {
                historico.pop();
            }
            
            localStorage.setItem('historico_redacoes', JSON.stringify(historico));
            carregarHistoricoLocal();
        }

        function carregarHistoricoLocal() {
            const historico = JSON.parse(localStorage.getItem('historico_redacoes') || '[]');
            
            if (historico.length === 0) {
                historicoLista.innerHTML = '<p style="text-align: center; color: var(--color-secondary);">Nenhuma redação no histórico</p>';
                return;
            }
            
            historicoLista.innerHTML = historico.map(item => `
                <div class="historico-item" onclick="carregarRedacaoHistorico(${item.id})">
                    <h5>${item.tema}</h5>
                    <p>Pontuação: <strong>${item.pontuacao}/1000</strong></p>
                    <div class="historico-meta">
                        <span>${new Date(item.data).toLocaleDateString('pt-BR')}</span>
                        <span>${item.tecnologia}</span>
                    </div>
                </div>
            `).join('');
        }

        function carregarHistorico() {
            historicoRedacoes.style.display = historicoRedacoes.style.display === 'none' ? 'block' : 'none';
            carregarHistoricoLocal();
        }

        function carregarRedacaoHistorico(id) {
            const historico = JSON.parse(localStorage.getItem('historico_redacoes') || '[]');
            const redacao = historico.find(item => item.id === id);
            
            if (redacao) {
                // Encontrar tema correspondente
                const temaCorrespondente = BANCO_TEMAS.find(t => t.descricao === redacao.tema);
                if (temaCorrespondente) {
                    temaSelect.value = temaCorrespondente.id;
                    carregarTemaAtual();
                }
                
                textoRedacao.value = redacao.texto;
                atualizarEstatisticasEditor();
                
                // Mostrar resultado anterior
                pontuacaoTotal.textContent = `${redacao.pontuacao}/1000`;
                correcaoDetalhada.innerHTML = redacao.correcao;
                resultadoArea.style.display = 'block';
                
                NotificacaoSistema.mostrar('Redação do histórico carregada!', 'sucesso');
                resultadoArea.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Carregar rascunho ao iniciar
        window.addEventListener('load', carregarRascunho);
    </script>
</body>
</html>